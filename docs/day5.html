<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>5&nbsp; Analysing lattice data; big geospatial datasets – Spatial Statistics with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./day4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./day5.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysing lattice data; big geospatial datasets</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Statistics with R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sswr/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Point Pattern data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geostatistical data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Machine Learning methods applied to spatial data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysing lattice data; big geospatial datasets</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#reading-materials" id="toc-reading-materials" class="nav-link active" data-scroll-target="#reading-materials">Reading materials</a></li>
  <li><a href="#exercises-for-today" id="toc-exercises-for-today" class="nav-link" data-scroll-target="#exercises-for-today"><span class="header-section-number">5.1</span> Exercises for Today</a></li>
  <li>
<a href="#analysing-lattice-data-neighbours-weights-models" id="toc-analysing-lattice-data-neighbours-weights-models" class="nav-link" data-scroll-target="#analysing-lattice-data-neighbours-weights-models"><span class="header-section-number">5.2</span> Analysing lattice data: neighbours, weights, models</a>
  <ul class="collapse">
<li><a href="#weights-matrices" id="toc-weights-matrices" class="nav-link" data-scroll-target="#weights-matrices">Weights matrices</a></li>
  <li><a href="#spatial-correlation-morans-i" id="toc-spatial-correlation-morans-i" class="nav-link" data-scroll-target="#spatial-correlation-morans-i">Spatial correlation: Moran’s I</a></li>
  </ul>
</li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.3</span> Exercises</a></li>
  <li>
<a href="#big-data-resource-constraints-in-data-science-projects" id="toc-big-data-resource-constraints-in-data-science-projects" class="nav-link" data-scroll-target="#big-data-resource-constraints-in-data-science-projects"><span class="header-section-number">5.4</span> Big data: resource constraints in data science projects</a>
  <ul class="collapse">
<li><a href="#there-is-no-cloud" id="toc-there-is-no-cloud" class="nav-link" data-scroll-target="#there-is-no-cloud">There is no cloud!</a></li>
  </ul>
</li>
  <li><a href="#what-is-a-big-dataset" id="toc-what-is-a-big-dataset" class="nav-link" data-scroll-target="#what-is-a-big-dataset"><span class="header-section-number">5.5</span> What is a big dataset?</a></li>
  <li><a href="#r-for-big-tabular-datasets" id="toc-r-for-big-tabular-datasets" class="nav-link" data-scroll-target="#r-for-big-tabular-datasets"><span class="header-section-number">5.6</span> R for big, tabular datasets</a></li>
  <li><a href="#big-geospatial" id="toc-big-geospatial" class="nav-link" data-scroll-target="#big-geospatial"><span class="header-section-number">5.7</span> Big geospatial</a></li>
  <li><a href="#access-mechanism" id="toc-access-mechanism" class="nav-link" data-scroll-target="#access-mechanism"><span class="header-section-number">5.8</span> Access mechanism</a></li>
  <li><a href="#examples-openeo" id="toc-examples-openeo" class="nav-link" data-scroll-target="#examples-openeo"><span class="header-section-number">5.9</span> Examples openEO</a></li>
  <li><a href="#example-rstac" id="toc-example-rstac" class="nav-link" data-scroll-target="#example-rstac"><span class="header-section-number">5.10</span> Example <code>rstac</code></a></li>
  <li><a href="#further-examples-from-r-spatial.org" id="toc-further-examples-from-r-spatial.org" class="nav-link" data-scroll-target="#further-examples-from-r-spatial.org"><span class="header-section-number">5.11</span> Further examples from r-spatial.org:</a></li>
  <li><a href="#examples-vsixxx" id="toc-examples-vsixxx" class="nav-link" data-scroll-target="#examples-vsixxx"><span class="header-section-number">5.12</span> Examples <code>/vsixxx</code></a></li>
  <li><a href="#simple-analysis-on-large-datasets" id="toc-simple-analysis-on-large-datasets" class="nav-link" data-scroll-target="#simple-analysis-on-large-datasets"><span class="header-section-number">5.13</span> “Simple” analysis on large datasets</a></li>
  <li>
<a href="#spatial-statistics-on-large-datasets" id="toc-spatial-statistics-on-large-datasets" class="nav-link" data-scroll-target="#spatial-statistics-on-large-datasets"><span class="header-section-number">5.14</span> Spatial statistics on large datasets</a>
  <ul class="collapse">
<li><a href="#geostatistics" id="toc-geostatistics" class="nav-link" data-scroll-target="#geostatistics">Geostatistics</a></li>
  </ul>
</li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">5.15</span> Exercises:</a></li>
  <li><a href="#if-time-is-left" id="toc-if-time-is-left" class="nav-link" data-scroll-target="#if-time-is-left"><span class="header-section-number">5.16</span> If time is left</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/edzer/sswr/edit/main/day5.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysing lattice data; big geospatial datasets</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"USER"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"edzer"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Understand</p>
<ul>
<li>what lattice data are, and which concepts, tools and models are used to analyse them</li>
<li>how big big datasets are, or can be</li>
<li>the difference between big vector and raster datasets, and datacubes</li>
<li>how to find data in complex programs</li>
<li>how to work with big data: download, or compute in the cloud near the data?</li>
</ul>
<section id="reading-materials" class="level3"><h3 class="anchored" data-anchor-id="reading-materials">Reading materials</h3>
<p>From <a href="https://r-spatial.org/book/">Spatial Data Science: with applications in R</a>:</p>
<ul>
<li>Chapter 14-17: Lattice data analysis</li>
<li>Chapter 9: Large data and cloud native</li>
</ul>
<p><a href="https://r-spatial.github.io/stars/articles/stars2.html">stars vignettes 2: proxy objects</a></p>
</section><section id="exercises-for-today" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="exercises-for-today">
<span class="header-section-number">5.1</span> Exercises for Today</h2>
<ul>
<li>Exercises of Ch 9: Big Data and Cloud Native</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Summary">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>What is big?</li>
<li>Raster or vector?</li>
<li>How to access large data sets?</li>
<li>Spatial statistics on large datasets</li>
</ul>
</div>
</div>
</section><section id="analysing-lattice-data-neighbours-weights-models" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="analysing-lattice-data-neighbours-weights-models">
<span class="header-section-number">5.2</span> Analysing lattice data: neighbours, weights, models</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pol_pres15</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">TERYT</span>, <span class="va">name</span>, <span class="va">types</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Simple feature collection with 6 features and 3 fields</span></span>
<span><span class="co"># Geometry type: MULTIPOLYGON</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: 235000 ymin: 367000 xmax: 281000 ymax: 413000</span></span>
<span><span class="co"># Projected CRS: ETRF2000-PL / CS92</span></span>
<span><span class="co">#    TERYT                name       types</span></span>
<span><span class="co"># 1 020101         BOLESŁAWIEC       Urban</span></span>
<span><span class="co"># 2 020102         BOLESŁAWIEC       Rural</span></span>
<span><span class="co"># 3 020103            GROMADKA       Rural</span></span>
<span><span class="co"># 4 020104        NOWOGRODZIEC Urban/rural</span></span>
<span><span class="co"># 5 020105          OSIECZNICA       Rural</span></span>
<span><span class="co"># 6 020106 WARTA BOLESŁAWIECKA       Rural</span></span>
<span><span class="co">#                         geometry</span></span>
<span><span class="co"># 1 MULTIPOLYGON (((261089 3855...</span></span>
<span><span class="co"># 2 MULTIPOLYGON (((254150 3837...</span></span>
<span><span class="co"># 3 MULTIPOLYGON (((275346 3846...</span></span>
<span><span class="co"># 4 MULTIPOLYGON (((251770 3770...</span></span>
<span><span class="co"># 5 MULTIPOLYGON (((263424 4060...</span></span>
<span><span class="co"># 6 MULTIPOLYGON (((267031 3870...</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"types"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="day5_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>We need to make the geometries valid first,</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_is_valid</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] FALSE</span></span>
<span><span class="va">pol_pres15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_is_valid</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we will consider polygons in relationship to their direct neighbours</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: spData</span></span>
<span><span class="va">pol_pres15</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html">poly2nb</a></span><span class="op">(</span>queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nb_q</span></span>
<span><span class="va">nb_q</span></span>
<span><span class="co"># Neighbour list object:</span></span>
<span><span class="co"># Number of regions: 2495 </span></span>
<span><span class="co"># Number of nonzero links: 14242 </span></span>
<span><span class="co"># Percentage nonzero weights: 0.229 </span></span>
<span><span class="co"># Average number of links: 5.71</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is the graph connected?</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">nb_q</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/compon.html">n.comp.nb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">nc</span></span>
<span><span class="co"># [1] 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pol_pres15</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span>of_largest_polygon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">coords</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">nb_q</span>, coords <span class="op">=</span> <span class="va">coords</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, points <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="day5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Alternative approaches to form neighbourhood matrices:</p>
<ul>
<li>based on distance, e.g.&nbsp;setting a distance threshold or selecting a fixed number of nearest neighbours</li>
<li>based on triangulating points, for instance polygon centroids</li>
<li>sphere of influence, a modification of triangulation</li>
<li>include neighbours from neighbours</li>
</ul>
<section id="weights-matrices" class="level3"><h3 class="anchored" data-anchor-id="weights-matrices">Weights matrices</h3>
<p>Weight matrices are needed in analysis, they determine how observations (or residuals) are weighted in a regression model.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">nb_q</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html">nb2listw</a></span><span class="op">(</span>style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">lw_q_B</span><span class="op">)</span></span>
<span><span class="co"># Characteristics of weights list object:</span></span>
<span><span class="co"># Neighbour list object:</span></span>
<span><span class="co"># Number of regions: 2495 </span></span>
<span><span class="co"># Number of nonzero links: 14242 </span></span>
<span><span class="co"># Percentage nonzero weights: 0.229 </span></span>
<span><span class="co"># Average number of links: 5.71 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Weights style: B </span></span>
<span><span class="co"># Weights constants summary:</span></span>
<span><span class="co">#      n      nn    S0    S1     S2</span></span>
<span><span class="co"># B 2495 6225025 14242 28484 357280</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="spatial-correlation-morans-i" class="level3"><h3 class="anchored" data-anchor-id="spatial-correlation-morans-i">Spatial correlation: Moran’s I</h3>
<p>Moran’s I is defined as</p>
<p><span class="math display">\[
I = \frac{n \sum_{(2)} w_{ij} z_i z_j}{S_0 \sum_{i=1}^{n} z_i^2}
\]</span> where <span class="math inline">\(x_i, i=1, \ldots, n\)</span> are <span class="math inline">\(n\)</span> observations on the numeric variable of interest, <span class="math inline">\(z_i = x_i - \bar{x}\)</span>, <span class="math inline">\(\bar{x} = \sum_{i=1}^{n} x_i / n\)</span>, <span class="math inline">\(\sum_{(2)} = \stackrel{\sum_{i=1}^{n} \sum_{j=1}^{n}}{i \neq j}\)</span>, <span class="math inline">\(w_{ij}\)</span> are the spatial weights, and <span class="math inline">\(S_0 = \sum_{(2)} w_{ij}\)</span>.</p>
<p>We can compute it as</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">I_turnout</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">lw_q_B</span>, randomisation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   Moran I test under normality</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:  pol_pres15$I_turnout  </span></span>
<span><span class="co"># weights: lw_q_B    </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Moran I statistic standard deviate = 58, p-value &lt;2e-16</span></span>
<span><span class="co"># alternative hypothesis: two.sided</span></span>
<span><span class="co"># sample estimates:</span></span>
<span><span class="co"># Moran I statistic       Expectation          Variance </span></span>
<span><span class="co">#          0.691434         -0.000401          0.000140</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">[</span><span class="st">"I_turnout"</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="day5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>A simple linear regression model, assuming independent observations, can be carried out using <code>lm</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">I_entitled_to_vote</span><span class="op">)</span></span>
<span><span class="co">#    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#    1308    4026    6033   12221   10524  594643</span></span>
<span><span class="op">(</span><span class="va">lm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">I_turnout</span> <span class="op">~</span> <span class="va">I_entitled_to_vote</span>, <span class="va">pol_pres15</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Call:</span></span>
<span><span class="co"># lm(formula = I_turnout ~ I_entitled_to_vote, data = pol_pres15)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Residuals:</span></span>
<span><span class="co">#      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co"># -0.21352 -0.04387 -0.00092  0.04150  0.23611 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Coefficients:</span></span>
<span><span class="co">#                    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co"># (Intercept)        4.39e-01   1.34e-03   328.1   &lt;2e-16 ***</span></span>
<span><span class="co"># I_entitled_to_vote 5.26e-07   4.18e-08    12.6   &lt;2e-16 ***</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Residual standard error: 0.0618 on 2493 degrees of freedom</span></span>
<span><span class="co"># Multiple R-squared:  0.0598,  Adjusted R-squared:  0.0595 </span></span>
<span><span class="co"># F-statistic:  159 on 1 and 2493 DF,  p-value: &lt;2e-16</span></span>
<span><span class="va">pol_pres15</span><span class="op">$</span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pol_pres15</span><span class="op">[</span><span class="st">"res"</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="day5_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>A spatial linear regression model (SEM: spatial error model), assuming independent observations, can be carried out using <code>lm</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">form</span> <span class="op">=</span> <span class="va">I_turnout</span> <span class="op">~</span> <span class="va">I_entitled_to_vote</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spatialreg/">spatialreg</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: Matrix</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Attaching package: 'spatialreg'</span></span>
<span><span class="co"># The following objects are masked from 'package:spdep':</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#     get.ClusterOption, get.coresOption, get.mcOption,</span></span>
<span><span class="co">#     get.VerboseOption, get.ZeroPolicyOption,</span></span>
<span><span class="co">#     set.ClusterOption, set.coresOption, set.mcOption,</span></span>
<span><span class="co">#     set.VerboseOption, set.ZeroPolicyOption</span></span>
<span><span class="va">SEM_pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spatialreg/reference/ML_models.html">errorsarlm</a></span><span class="op">(</span><span class="va">form</span>, data <span class="op">=</span> <span class="va">pol_pres15</span>, Durbin <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      listw <span class="op">=</span> <span class="va">lw_q_B</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exercises" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">5.3</span> Exercises</h2>
<ol type="1">
<li>Compare the results of the simple linear regression with the spatial error model</li>
<li>Fit a spatial Durbin model, using <code>Durbin = TRUE</code> in the same call to <code>errorsarlm</code>
</li>
<li>carry out a likelyhood ratio test to compare both SEM models (<code><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lmtest::lrtest()</a></code>, see the SDS book Ch 17)</li>
</ol></section><section id="big-data-resource-constraints-in-data-science-projects" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="big-data-resource-constraints-in-data-science-projects">
<span class="header-section-number">5.4</span> Big data: resource constraints in data science projects</h2>
<p>Constraints concern the availability of:</p>
<ul>
<li>time (your time, time of team members)</li>
<li>compute (pc’s, cluster, private cloud)</li>
<li>money (e.g.&nbsp;to hire and/or (re)train people, or to rent public cloud infrastructure)</li>
</ul>
<p>Public clouds provide:</p>
<ul>
<li>infinite (in practice) compute</li>
<li>infinite (in practice) storage</li>
</ul>
<p>but cost</p>
<ul>
<li>hard money to use (compute, storage, network/data access)</li>
<li>people capacity to setup and maintain</li>
</ul>
<section id="there-is-no-cloud" class="level3"><h3 class="anchored" data-anchor-id="there-is-no-cloud">There is no cloud!</h3>
<p>it’s just someone else’s computer!</p>
<ul>
<li>which is true: the computers have a different shape, but are just like your laptop:
<ul>
<li>they have a CPU, main memory, hard drive, possibly a GPU</li>
<li>quite often you will find yourself on a virtual machine, which acts as a normal computer</li>
<li>but see below: they have object storage!</li>
</ul>
</li>
</ul></section></section><section id="what-is-a-big-dataset" class="level2" data-number="5.5"><h2 data-number="5.5" class="anchored" data-anchor-id="what-is-a-big-dataset">
<span class="header-section-number">5.5</span> What is a big dataset?</h2>
<ul>
<li>What is big?
<ul>
<li>too big to handle in main memory (with some copying) (Gb)</li>
<li>too big to fit in memory (20 Gb)</li>
<li>too big to download (Tb)</li>
<li>too big to fit on the hard drive, or local file storage (10 Tb)</li>
<li>too big to move (copy) to your institution (100 Tb - Pb)</li>
</ul>
</li>
</ul></section><section id="r-for-big-tabular-datasets" class="level2" data-number="5.6"><h2 data-number="5.6" class="anchored" data-anchor-id="r-for-big-tabular-datasets">
<span class="header-section-number">5.6</span> R for big, tabular datasets</h2>
<ul>
<li>In-memory solutions: <code>data.table</code>, <code>duckdb</code>, <code>polars</code> improve speed (use indexes)</li>
<li>Out-of-memory solution: <code>DBI</code> or <code>tidyverse</code> via <code>dbplyr</code>, connect to
<ul>
<li>a local, on-disc database like MariaDB, PostgreSQL, or MySQL</li>
<li>cloud-based databases like Google BigQuery, Snowflake,</li>
</ul>
</li>
</ul></section><section id="big-geospatial" class="level2" data-number="5.7"><h2 data-number="5.7" class="anchored" data-anchor-id="big-geospatial">
<span class="header-section-number">5.7</span> Big geospatial</h2>
<ul>
<li>Large <strong>vector</strong> datasets, examples:
<ul>
<li>all building footprints of a continents, <a href="https://github.com/microsoft/USBuildingFootprints">link</a>
</li>
<li>all rivers, e.g.&nbsp;of the US, <a href="https://www.arcgis.com/home/item.html?id=1e29e33360c8441bbb018663273a046e">link</a>
</li>
<li>OpenStreetMap, <a href="https://wiki.openstreetmap.org/wiki/Downloading_data">link</a>
</li>
<li>all agricultural parcels of a continent, e.g.&nbsp;<a href="https://github.com/maja601/EuroCrops">EuroCrops</a>
</li>
</ul>
</li>
<li>Large <strong>raster</strong> datasets, image collections and data cubes:
<ul>
<li><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview">ERA-5</a></li>
<li>
<a href="https://pcmdi.llnl.gov/CMIP6/">CMIP-6</a>, partly on <a href="https://console.cloud.google.com/marketplace/product/noaa-public/cmip6?project=erudite-gate-281920">google</a> and <a href="https://registry.opendata.aws/cmip6/">AWS</a>
</li>
<li>Copernicus (Sentinel-1, 2, 3, 5p, etc), e.g.&nbsp;on <a href="https://dataspace.copernicus.eu/">CDSE</a>
</li>
<li>Landsat, MODIS, … <a href="https://earthexplorer.usgs.gov/">download</a>
</li>
</ul>
</li>
<li>Cloud solutions, cloud platforms, <em>with</em> platform lock-in:
<ul>
<li><a href="https://www.esri.com/en-us/arcgis/products/arcgis-online/overview">ArcGIS online</a></li>
<li><a href="https://www.sentinel-hub.com/">Sentinel Hub</a></li>
<li><a href="https://earthengine.google.com/">Google Earth Engine</a></li>
<li><a href="https://planetarycomputer.microsoft.com/">Microsoft Planetary Computer</a></li>
<li>
<a href="https://aws.amazon.com/earth/">Earth on Amazon</a> (AWS US-west Oregon: COGS + STAC for S1 + S2)</li>
<li>Copernicus Data Space Ecosystem (but has <a href="https://openeo.org/">openEO</a>: a fully open standard and open source software stack)</li>
</ul>
</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clouds and object storage
</div>
</div>
<div class="callout-body-container callout-body">
<p>Object storage abstracts away hard drives and file systems!</p>
<ul>
<li>e.g.&nbsp;S3 bucket (AWS/OpenStack):
<ul>
<li>total size is <em>unlimited</em>
</li>
<li>maximum object size 5 Tb (AWS S3)</li>
<li>idea: write once, read many times</li>
<li>large objects: write piece-wise</li>
<li>http range requests</li>
<li>price depends on size, access speed, amount of requests</li>
<li>tabular data: Parquet</li>
</ul>
</li>
<li>large data processing: collocate processing and storage
<ul>
<li>avoid network between locations / data centers</li>
<li>network inside a data center is fast / cheap</li>
</ul>
</li>
</ul>
</div>
</div>
</section><section id="access-mechanism" class="level2" data-number="5.8"><h2 data-number="5.8" class="anchored" data-anchor-id="access-mechanism">
<span class="header-section-number">5.8</span> Access mechanism</h2>
<ul>
<li>API:
<ul>
<li>process: <a href="https://openeo.cloud/">openEO cloud</a>, <a href="https://openeo.dataspace.copernicus.eu/">openEO on CDSE</a>,</li>
<li>select, download, process: <a href="https://cds.climate.copernicus.eu/#!/home">Climate Data Store</a>
</li>
<li>find “assets” (files): <a href="https://stacspec.org/en">STAC</a>, <a href="https://stacindex.org/">stacindex</a>
</li>
</ul>
</li>
<li>partial reads of data cubes: variable, bounding box, strided (low resolution), time period</li>
<li>vector tiles: pmtiles, flatgeobuf</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cloud-optimized, cloud-native geoospatial
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Cloud-optimized formats let you read <em>sections</em> of large, remote files using HTTP range requests</li>
<li>examples: Cloud-optimized GeoTIFF (COG), GeoZarr, GeoParquet</li>
<li>These are described in the <a href="https://guide.cloudnativegeo.org/">Cloud-Optimized Geospatial Formats Guide</a>
</li>
</ul>
</div>
</div>
</section><section id="examples-openeo" class="level2" data-number="5.9"><h2 data-number="5.9" class="anchored" data-anchor-id="examples-openeo">
<span class="header-section-number">5.9</span> Examples openEO</h2>
<p>Two video’s from me taken during the 2023 OpenGeoHub Summerschool, on the topic “Cloud-based analysis of Earth Observation data using openEO Platform, R and Python” can be found here:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=NurpU0V6JG8">part 1</a></li>
<li><a href="https://www.youtube.com/watch?v=mrY8VKOoz3c">part 2</a></li>
</ul></section><section id="example-rstac" class="level2" data-number="5.10"><h2 data-number="5.10" class="anchored" data-anchor-id="example-rstac">
<span class="header-section-number">5.10</span> Example <a href="https://cran.r-project.org/web/packages/rstac/index.html"><code>rstac</code></a>
</h2>
<p>Using <a href="https://registry.opendata.aws/sentinel-2-l2a-cogs/">Sentinel-2 COGs at AWS</a>, and its <a href="https://earth-search.aws.element84.com/v1">stac</a>:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brazil-data-cube.github.io/rstac/">rstac</a></span><span class="op">)</span> <span class="co"># modified from the package docs:</span></span>
<span><span class="va">s_obj</span> <span class="op">=</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac.html">stac</a></span><span class="op">(</span><span class="st">"https://earth-search.aws.element84.com/v1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/collections.html">collections</a></span><span class="op">(</span><span class="va">s_obj</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/request.html">get_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># ###Collections</span></span>
<span><span class="co"># - collections (9 item(s)):</span></span>
<span><span class="co">#   - sentinel-2-pre-c1-l2a</span></span>
<span><span class="co">#   - cop-dem-glo-30</span></span>
<span><span class="co">#   - naip</span></span>
<span><span class="co">#   - cop-dem-glo-90</span></span>
<span><span class="co">#   - landsat-c2-l2</span></span>
<span><span class="co">#   - sentinel-2-l2a</span></span>
<span><span class="co">#   - sentinel-2-l1c</span></span>
<span><span class="co">#   - sentinel-2-c1-l2a</span></span>
<span><span class="co">#   - sentinel-1-grd</span></span>
<span><span class="co"># - field(s): collections, links, context</span></span>
<span><span class="va">it_obj</span> <span class="op">&lt;-</span> <span class="va">s_obj</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/stac_search.html">stac_search</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"sentinel-2-l2a"</span>,</span>
<span>              bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">47.02148</span>, <span class="op">-</span><span class="fl">17.35063</span>, <span class="op">-</span><span class="fl">42.53906</span>, <span class="op">-</span><span class="fl">12.98314</span><span class="op">)</span>,</span>
<span>              datetime <span class="op">=</span> <span class="st">"2022-02-12T00:00:00Z/2022-03-18T00:00:00Z"</span>,</span>
<span>              limit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/request.html">get_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">it_obj</span></span>
<span><span class="co"># ###Items</span></span>
<span><span class="co"># - matched feature(s): 361</span></span>
<span><span class="co"># - features (1 item(s) / 360 not fetched):</span></span>
<span><span class="co">#   - S2A_23KMA_20220317_0_L2A</span></span>
<span><span class="co"># - assets: </span></span>
<span><span class="co"># aot, aot-jp2, blue, blue-jp2, coastal, coastal-jp2, granule_metadata, green, green-jp2, nir, nir-jp2, nir08, nir08-jp2, nir09, nir09-jp2, red, red-jp2, rededge1, rededge1-jp2, rededge2, rededge2-jp2, rededge3, rededge3-jp2, scl, scl-jp2, swir16, swir16-jp2, swir22, swir22-jp2, thumbnail, tileinfo_metadata, visual, visual-jp2, wvp, wvp-jp2</span></span>
<span><span class="co"># - item's fields: </span></span>
<span><span class="co"># assets, bbox, collection, geometry, id, links, properties, stac_extensions, stac_version, type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>then, download (here only one item):</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">download_items</span> <span class="op">&lt;-</span> <span class="va">it_obj</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://brazil-data-cube.github.io/rstac/reference/assets_functions.html">assets_download</a></span><span class="op">(</span>assets_name <span class="op">=</span> <span class="st">"thumbnail"</span>, items_max <span class="op">=</span> <span class="fl">1</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and examine</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="va">tif</span> <span class="op">=</span> <span class="st">"sentinel-s2-l2a-cogs/23/K/MA/2022/3/S2A_23KMA_20220317_0_L2A/B04.tif"</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html">gdal_utils</a></span><span class="op">(</span><span class="st">"info"</span>, <span class="va">tif</span><span class="op">)</span></span>
<span><span class="co"># Driver: GTiff/GeoTIFF</span></span>
<span><span class="co"># Files: sentinel-s2-l2a-cogs/23/K/MA/2022/3/S2A_23KMA_20220317_0_L2A/B04.tif</span></span>
<span><span class="co"># Size is 10980, 10980</span></span>
<span><span class="co"># Coordinate System is:</span></span>
<span><span class="co"># PROJCRS["WGS 84 / UTM zone 23S",</span></span>
<span><span class="co">#     BASEGEOGCRS["WGS 84",</span></span>
<span><span class="co">#         ENSEMBLE["World Geodetic System 1984 ensemble",</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (Transit)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G730)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G873)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G1150)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G1674)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G1762)"],</span></span>
<span><span class="co">#             MEMBER["World Geodetic System 1984 (G2139)"],</span></span>
<span><span class="co">#             ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co">#                 LENGTHUNIT["metre",1]],</span></span>
<span><span class="co">#             ENSEMBLEACCURACY[2.0]],</span></span>
<span><span class="co">#         PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#         ID["EPSG",4326]],</span></span>
<span><span class="co">#     CONVERSION["UTM zone 23S",</span></span>
<span><span class="co">#         METHOD["Transverse Mercator",</span></span>
<span><span class="co">#             ID["EPSG",9807]],</span></span>
<span><span class="co">#         PARAMETER["Latitude of natural origin",0,</span></span>
<span><span class="co">#             ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co">#             ID["EPSG",8801]],</span></span>
<span><span class="co">#         PARAMETER["Longitude of natural origin",-45,</span></span>
<span><span class="co">#             ANGLEUNIT["degree",0.0174532925199433],</span></span>
<span><span class="co">#             ID["EPSG",8802]],</span></span>
<span><span class="co">#         PARAMETER["Scale factor at natural origin",0.9996,</span></span>
<span><span class="co">#             SCALEUNIT["unity",1],</span></span>
<span><span class="co">#             ID["EPSG",8805]],</span></span>
<span><span class="co">#         PARAMETER["False easting",500000,</span></span>
<span><span class="co">#             LENGTHUNIT["metre",1],</span></span>
<span><span class="co">#             ID["EPSG",8806]],</span></span>
<span><span class="co">#         PARAMETER["False northing",10000000,</span></span>
<span><span class="co">#             LENGTHUNIT["metre",1],</span></span>
<span><span class="co">#             ID["EPSG",8807]]],</span></span>
<span><span class="co">#     CS[Cartesian,2],</span></span>
<span><span class="co">#         AXIS["(E)",east,</span></span>
<span><span class="co">#             ORDER[1],</span></span>
<span><span class="co">#             LENGTHUNIT["metre",1]],</span></span>
<span><span class="co">#         AXIS["(N)",north,</span></span>
<span><span class="co">#             ORDER[2],</span></span>
<span><span class="co">#             LENGTHUNIT["metre",1]],</span></span>
<span><span class="co">#     USAGE[</span></span>
<span><span class="co">#         SCOPE["Navigation and medium accuracy spatial referencing."],</span></span>
<span><span class="co">#         AREA["Between 48°W and 42°W, southern hemisphere between 80°S and equator, onshore and offshore. Brazil."],</span></span>
<span><span class="co">#         BBOX[-80,-48,0,-42]],</span></span>
<span><span class="co">#     ID["EPSG",32723]]</span></span>
<span><span class="co"># Data axis to CRS axis mapping: 1,2</span></span>
<span><span class="co"># Origin = (399960.000000000000000,8100040.000000000000000)</span></span>
<span><span class="co"># Pixel Size = (10.000000000000000,-10.000000000000000)</span></span>
<span><span class="co"># Metadata:</span></span>
<span><span class="co">#   AREA_OR_POINT=Area</span></span>
<span><span class="co">#   OVR_RESAMPLING_ALG=AVERAGE</span></span>
<span><span class="co"># Image Structure Metadata:</span></span>
<span><span class="co">#   COMPRESSION=DEFLATE</span></span>
<span><span class="co">#   INTERLEAVE=BAND</span></span>
<span><span class="co">#   PREDICTOR=2</span></span>
<span><span class="co"># Corner Coordinates:</span></span>
<span><span class="co"># Upper Left  (  399960.000, 8100040.000) ( 45d56'26.60"W, 17d10'56.12"S)</span></span>
<span><span class="co"># Lower Left  (  399960.000, 7990240.000) ( 45d56'45.24"W, 18d10'28.55"S)</span></span>
<span><span class="co"># Upper Right (  509760.000, 8100040.000) ( 44d54'29.58"W, 17d11' 3.94"S)</span></span>
<span><span class="co"># Lower Right (  509760.000, 7990240.000) ( 44d54'27.77"W, 18d10'36.85"S)</span></span>
<span><span class="co"># Center      (  454860.000, 8045140.000) ( 45d25'32.30"W, 17d40'48.86"S)</span></span>
<span><span class="co"># Band 1 Block=1024x1024 Type=UInt16, ColorInterp=Gray</span></span>
<span><span class="co">#   NoData Value=0</span></span>
<span><span class="co">#   Overviews: 5490x5490, 2745x2745, 1373x1373, 687x687</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: abind</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># downsample set to 8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="day5_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Breakout session 2">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Breakout session 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Discuss:</p>
<ul>
<li>Have you used any cloud platforms for processing geospatial data?</li>
<li>What is your position with respect to platform lock-in?</li>
</ul>
</div>
</div>
</section><section id="further-examples-from-r-spatial.org" class="level2" data-number="5.11"><h2 data-number="5.11" class="anchored" data-anchor-id="further-examples-from-r-spatial.org">
<span class="header-section-number">5.11</span> Further examples from r-spatial.org:</h2>
<ul>
<li><a href="https://r-spatial.org/r/2021/04/23/cloud-based-cubes.html">Cloud-based processing of satellite image collections in R using STAC, COGs, and on-demand data cubes</a></li>
<li><a href="https://r-spatial.org/r/2022/09/13/zarr.html">Reading Zarr files with R package stars</a></li>
<li><a href="https://r-spatial.org/r/2022/11/24/openeo.html">Processing large scale satellite imagery with openEO Platform and R</a></li>
</ul></section><section id="examples-vsixxx" class="level2" data-number="5.12"><h2 data-number="5.12" class="anchored" data-anchor-id="examples-vsixxx">
<span class="header-section-number">5.12</span> Examples <code>/vsixxx</code>
</h2>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html">curl_download</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://github.com/paleolimbot/geoarrow-data/releases/download/v0.0.1/nshn_water_line.gpkg"</span>,</span>
<span>  <span class="st">"nshn_water_line.gpkg"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"nshn_water_line.gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Simple feature collection with 483268 features and 33 fields</span></span>
<span><span class="co"># Geometry type: MULTILINESTRING</span></span>
<span><span class="co"># Dimension:     XYZ</span></span>
<span><span class="co"># Bounding box:  xmin: 216000 ymin: 4790000 xmax: 782000 ymax: 5240000</span></span>
<span><span class="co"># z_range:       zmin: -41.7 zmax: 530</span></span>
<span><span class="co"># Projected CRS: NAD83 / UTM zone 20N</span></span>
<span><span class="co"># # A tibble: 483,268 × 34</span></span>
<span><span class="co">#   OBJECTID FEAT_CODE ZVALUE PLANLENGTH  MINZ  MAXZ LINE_CLASS</span></span>
<span><span class="co">#      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;int&gt;</span></span>
<span><span class="co"># 1        2 WACO20       0.2      280.    0.2   0.2          3</span></span>
<span><span class="co"># 2        3 WACO20       0.2      185.    0.2   0.2          3</span></span>
<span><span class="co"># 3        4 WACO20       0.2      179.    0.2   0.2          3</span></span>
<span><span class="co"># 4        5 WACO20       0.2     1779.    0.2   0.2          3</span></span>
<span><span class="co"># 5        6 WACO20       0.2      470.    0.2   0.2          3</span></span>
<span><span class="co"># 6        7 WACO20       0.2       57.7   0.2   0.2          3</span></span>
<span><span class="co"># # ℹ 483,262 more rows</span></span>
<span><span class="co"># # ℹ 27 more variables: FLOWDIR &lt;int&gt;, LEVELPRIOR &lt;int&gt;,</span></span>
<span><span class="co"># #   LAKEID_1 &lt;chr&gt;, LAKENAME_1 &lt;chr&gt;, LAKEID_2 &lt;chr&gt;,</span></span>
<span><span class="co"># #   LAKENAME_2 &lt;chr&gt;, RIVID_1 &lt;chr&gt;, RIVNAME_1 &lt;chr&gt;,</span></span>
<span><span class="co"># #   RIVID_2 &lt;chr&gt;, RIVNAME_2 &lt;chr&gt;, MISCID_1 &lt;chr&gt;,</span></span>
<span><span class="co"># #   MISCNAME_1 &lt;chr&gt;, MISCID_2 &lt;chr&gt;, MISCNAME_2 &lt;chr&gt;,</span></span>
<span><span class="co"># #   MISCID_3 &lt;chr&gt;, MISCNAME_3 &lt;chr&gt;, MISCID_4 &lt;chr&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From https://github.com/microsoft/USBuildingFootprints downloaded <a href="https://minedbuildings.z5.web.core.windows.net/legacy/usbuildings-v2/Maine.geojson.zip">Maine.geojson.zip</a>, and read with</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"/vsizip/Maine.geojson.zip"</span><span class="op">)</span><span class="op">)</span> <span class="co"># /vsizip: indicates data source is a zipped file</span></span>
<span><span class="co"># Simple feature collection with 758999 features and 2 fields</span></span>
<span><span class="co"># Geometry type: POLYGON</span></span>
<span><span class="co"># Dimension:     XY</span></span>
<span><span class="co"># Bounding box:  xmin: -71.1 ymin: 43 xmax: -67 ymax: 47.5</span></span>
<span><span class="co"># Geodetic CRS:  WGS 84</span></span>
<span><span class="co"># # A tibble: 758,999 × 3</span></span>
<span><span class="co">#   release capture_dates_range                               geometry</span></span>
<span><span class="co">#     &lt;int&gt; &lt;chr&gt;                                        &lt;POLYGON [°]&gt;</span></span>
<span><span class="co"># 1       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># 2       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># 3       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># 4       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># 5       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># 6       1 ""                  ((-67 44.9, -67 44.9, -67 44.9, -67 4…</span></span>
<span><span class="co"># # ℹ 758,993 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or read directly from github into R:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"/vsizip/vsicurl/https://minedbuildings.z5.web.core.windows.net/legacy/usbuildings-v2/Maine.geojson.zip"</span><span class="op">)</span></span>
<span><span class="co"># /vsicurl: indicates data source is a URL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="simple-analysis-on-large-datasets" class="level2" data-number="5.13"><h2 data-number="5.13" class="anchored" data-anchor-id="simple-analysis-on-large-datasets">
<span class="header-section-number">5.13</span> “Simple” analysis on large datasets</h2>
<ul>
<li>process full archives, compute <em>in</em> the cloud</li>
<li>select subsets, download, process locally:
<ul>
<li>spatial subset</li>
<li>temporal subset</li>
<li>sampled at lower resolution (spatially, temporally)</li>
<li>aggregated (=processed?) to lower resolution</li>
</ul>
</li>
<li>in some disciplines (Earth Observation?) there seems to be a belief that processing at the <em>full</em> resolution is the only thing that produces real science</li>
<li>there is surprisingly little literature on the loss of information when processing at lower resolution, e.g.&nbsp;when the goal is to create a curve of yearly deforestation over an area as large as Brazil</li>
</ul></section><section id="spatial-statistics-on-large-datasets" class="level2" data-number="5.14"><h2 data-number="5.14" class="anchored" data-anchor-id="spatial-statistics-on-large-datasets">
<span class="header-section-number">5.14</span> Spatial statistics on large datasets</h2>
<section id="geostatistics" class="level3"><h3 class="anchored" data-anchor-id="geostatistics">Geostatistics</h3>
<ul>
<li><a href="https://cran.r-project.org/web/packages/RandomForestsGLS/">RandomForestsGLS</a></li>
<li><a href="https://cran.r-project.org/web/packages/spNNGP/index.html">spNNGP</a></li>
<li><a href="https://cran.r-project.org/web/packages/FRK/index.html">FRK</a></li>
</ul>
<p>A key paper comparing different approaches is Heaton, Matthew J., Abhirup Datta, Andrew O. Finley, Reinhard Furrer, Joseph Guinness, Rajarshi Guhaniyogi, Florian Gerber, et al.&nbsp;2018. “A Case Study Competition Among Methods for Analyzing Large Spatial Data.” Journal of Agricultural, Biological and Environmental Statistics, December. <a href="https://doi.org/10.1007/s13253-018-00348-w">DOI</a>.</p>
</section></section><section id="exercises-1" class="level2" data-number="5.15"><h2 data-number="5.15" class="anchored" data-anchor-id="exercises-1">
<span class="header-section-number">5.15</span> Exercises:</h2>
<ol type="1">
<li>Discuss: Have you used datasets obtained from cloud storage? For which case(s)?</li>
<li>Discuss: Have you used cloud processing? For which case(s)</li>
</ol></section><section id="if-time-is-left" class="level2" data-number="5.16"><h2 data-number="5.16" class="anchored" data-anchor-id="if-time-is-left">
<span class="header-section-number">5.16</span> If time is left</h2>
<ul>
<li><a href="https://r-spatial.org/book/09-Large.html#exercises">Exercises chapter 9</a></li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/edzer\.github\.io\/sswr\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./day4.html" class="pagination-link" aria-label="Machine Learning methods applied to spatial data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Machine Learning methods applied to spatial data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb19" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="in">ev &lt;- Sys.getenv("USER") == "edzer"</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysing lattice data; big geospatial datasets</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>Understand</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>what lattice data are, and which concepts, tools and models are used to analyse them</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>how big big datasets are, or can be</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the difference between big vector and raster datasets, and datacubes</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>how to find data in complex programs</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>how to work with big data: download, or compute in the cloud near the data?</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reading materials</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>From <span class="co">[</span><span class="ot">Spatial Data Science: with applications in R</span><span class="co">](https://r-spatial.org/book/)</span>:</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Chapter 14-17: Lattice data analysis</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Chapter 9: Large data and cloud native</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">stars vignettes 2: proxy objects</span><span class="co">](https://r-spatial.github.io/stars/articles/stars2.html)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises for Today</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Exercises of Ch 9: Big Data and Cloud Native</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Summary"}</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is big?</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Raster or vector?</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How to access large data sets?</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial statistics on large datasets</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysing lattice data: neighbours, weights, models</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pol_pres15, <span class="at">package =</span> <span class="st">"spDataLarge"</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>pol_pres15 <span class="sc">|&gt;</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="fu">c</span>(TERYT, name, types)) <span class="sc">|&gt;</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(pol_pres15) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">"types"</span>)</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>We need to make the geometries valid first,</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(pol_pres15) <span class="sc">|&gt;</span> <span class="fu">all</span>()</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>pol_pres15 <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(pol_pres15)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(pol_pres15) <span class="sc">|&gt;</span> <span class="fu">all</span>()</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>First, we will consider polygons in relationship to their direct neighbours</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>pol_pres15 <span class="sc">|&gt;</span> <span class="fu">poly2nb</span>(<span class="at">queen =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> nb_q</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>nb_q</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>Is the graph connected?</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>(nb_q <span class="sc">|&gt;</span> <span class="fu">n.comp.nb</span>())<span class="sc">$</span>nc</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>pol_pres15 <span class="sc">|&gt;</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_centroid</span>(<span class="at">of_largest_polygon =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> coords</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(pol_pres15), <span class="at">border =</span> <span class="st">'grey'</span>)</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nb_q, <span class="at">coords =</span> coords, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">points =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>Alternative approaches to form neighbourhood matrices:</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>based on distance, e.g. setting a distance threshold or selecting a fixed number of nearest neighbours</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>based on triangulating points, for instance polygon centroids</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>sphere of influence, a modification of triangulation</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>include neighbours from neighbours</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a><span class="fu">### Weights matrices</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>Weight matrices are needed in analysis, they determine how observations</span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>(or residuals) are weighted in a regression model.</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>(nb_q <span class="sc">|&gt;</span> <span class="fu">nb2listw</span>(<span class="at">style =</span> <span class="st">"B"</span>) <span class="ot">-&gt;</span> lw_q_B)</span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial correlation: Moran's I</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>Moran's I is defined as</span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>I = \frac{n \sum_{(2)} w_{ij} z_i z_j}{S_0 \sum_{i=1}^{n} z_i^2}</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>where $x_i, i=1, \ldots, n$ are $n$ observations on the numeric variable of interest, $z_i = x_i - \bar{x}$, $\bar{x} = \sum_{i=1}^{n} x_i / n$, $\sum_{(2)} = \stackrel{\sum_{i=1}^{n} \sum_{j=1}^{n}}{i \neq j}$, $w_{ij}$ are the spatial weights, and $S_0 = \sum_{(2)} w_{ij}$. </span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>We can compute it as</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>pol_pres15<span class="sc">$</span>I_turnout <span class="sc">|&gt;</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">moran.test</span>(lw_q_B, <span class="at">randomisation =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>               <span class="at">alternative =</span> <span class="st">"two.sided"</span>)</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pol_pres15[<span class="st">"I_turnout"</span>])</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>A simple linear regression model, assuming independent observations, can be carried out using <span class="in">`lm`</span>:</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pol_pres15<span class="sc">$</span>I_entitled_to_vote)</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>(lm0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(I_turnout <span class="sc">~</span> I_entitled_to_vote, pol_pres15)) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>pol_pres15<span class="sc">$</span>res <span class="ot">=</span> <span class="fu">residuals</span>(lm0)</span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pol_pres15[<span class="st">"res"</span>])</span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>A spatial linear regression model (SEM: spatial error model),</span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>assuming independent observations, can be carried out using <span class="in">`lm`</span>:</span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>form <span class="ot">=</span> I_turnout <span class="sc">~</span> I_entitled_to_vote</span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatialreg)</span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a>SEM_pres <span class="ot">&lt;-</span> <span class="fu">errorsarlm</span>(form, <span class="at">data =</span> pol_pres15, <span class="at">Durbin =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">listw =</span> lw_q_B, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Compare the results of the simple linear regression with the spatial error model</span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Fit a spatial Durbin model, using <span class="in">`Durbin = TRUE`</span> in the same call to <span class="in">`errorsarlm`</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>carry out a likelyhood ratio test to compare both SEM models (<span class="in">`lmtest::lrtest()`</span>, see the SDS book Ch 17)</span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## Big data: resource constraints in data science projects</span></span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>Constraints concern the availability of:</span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>time (your time, time of team members)</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>compute (pc's, cluster, private cloud)</span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>money (e.g. to hire and/or (re)train people, or to rent public cloud infrastructure)</span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>Public clouds provide:</span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>infinite (in practice) compute</span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>infinite (in practice) storage</span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a>but cost</span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>hard money to use (compute, storage, network/data access)</span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>people capacity to setup and maintain</span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a><span class="fu">### There is no cloud!</span></span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a>it's just someone else's computer!</span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>which is true: the computers have a different shape, but are just like your laptop:</span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>they have a CPU, main memory, hard drive, possibly a GPU</span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>quite often you will find yourself on a virtual machine, which acts as a normal computer</span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>but see below: they have object storage!</span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is a big dataset?</span></span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is big?</span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>too big to handle in main memory (with some copying) (Gb)</span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>too big to fit in memory (20 Gb)</span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>too big to download (Tb)</span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>too big to fit on the hard drive, or local file storage (10 Tb)</span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>too big to move (copy) to your institution (100 Tb - Pb)</span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a><span class="fu">## R for big, tabular datasets</span></span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In-memory solutions: <span class="in">`data.table`</span>, <span class="in">`duckdb`</span>, <span class="in">`polars`</span> improve speed (use indexes)</span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Out-of-memory solution: <span class="in">`DBI`</span> or <span class="in">`tidyverse`</span> via <span class="in">`dbplyr`</span>, connect to</span>
<span id="cb19-195"><a href="#cb19-195" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>a local, on-disc database like MariaDB, PostgreSQL, or MySQL</span>
<span id="cb19-196"><a href="#cb19-196" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>cloud-based databases like Google BigQuery, Snowflake,</span>
<span id="cb19-197"><a href="#cb19-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-198"><a href="#cb19-198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Big geospatial</span></span>
<span id="cb19-199"><a href="#cb19-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-200"><a href="#cb19-200" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Large **vector** datasets, examples:</span>
<span id="cb19-201"><a href="#cb19-201" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>all building footprints of a continents, <span class="co">[</span><span class="ot">link</span><span class="co">](https://github.com/microsoft/USBuildingFootprints)</span></span>
<span id="cb19-202"><a href="#cb19-202" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>all rivers, e.g. of the US, <span class="co">[</span><span class="ot">link</span><span class="co">](https://www.arcgis.com/home/item.html?id=1e29e33360c8441bbb018663273a046e)</span></span>
<span id="cb19-203"><a href="#cb19-203" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>OpenStreetMap, <span class="co">[</span><span class="ot">link</span><span class="co">](https://wiki.openstreetmap.org/wiki/Downloading_data)</span></span>
<span id="cb19-204"><a href="#cb19-204" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>all agricultural parcels of a continent, e.g. <span class="co">[</span><span class="ot">EuroCrops</span><span class="co">](https://github.com/maja601/EuroCrops)</span></span>
<span id="cb19-205"><a href="#cb19-205" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Large **raster** datasets, image collections and data cubes:</span>
<span id="cb19-206"><a href="#cb19-206" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">ERA-5</span><span class="co">](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview)</span></span>
<span id="cb19-207"><a href="#cb19-207" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">CMIP-6</span><span class="co">](https://pcmdi.llnl.gov/CMIP6/)</span>, partly on <span class="co">[</span><span class="ot">google</span><span class="co">](https://console.cloud.google.com/marketplace/product/noaa-public/cmip6?project=erudite-gate-281920)</span> and <span class="co">[</span><span class="ot">AWS</span><span class="co">](https://registry.opendata.aws/cmip6/)</span></span>
<span id="cb19-208"><a href="#cb19-208" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Copernicus (Sentinel-1, 2, 3, 5p, etc), e.g. on <span class="co">[</span><span class="ot">CDSE</span><span class="co">](https://dataspace.copernicus.eu/)</span></span>
<span id="cb19-209"><a href="#cb19-209" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Landsat, MODIS, ... <span class="co">[</span><span class="ot">download</span><span class="co">](https://earthexplorer.usgs.gov/)</span></span>
<span id="cb19-210"><a href="#cb19-210" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cloud solutions, cloud platforms, *with* platform lock-in:</span>
<span id="cb19-211"><a href="#cb19-211" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">ArcGIS online</span><span class="co">](https://www.esri.com/en-us/arcgis/products/arcgis-online/overview)</span></span>
<span id="cb19-212"><a href="#cb19-212" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Sentinel Hub</span><span class="co">](https://www.sentinel-hub.com/)</span></span>
<span id="cb19-213"><a href="#cb19-213" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Google Earth Engine</span><span class="co">](https://earthengine.google.com/)</span></span>
<span id="cb19-214"><a href="#cb19-214" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Microsoft Planetary Computer</span><span class="co">](https://planetarycomputer.microsoft.com/)</span></span>
<span id="cb19-215"><a href="#cb19-215" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="co">[</span><span class="ot">Earth on Amazon</span><span class="co">](https://aws.amazon.com/earth/)</span> (AWS US-west Oregon: COGS + STAC for S1 + S2)</span>
<span id="cb19-216"><a href="#cb19-216" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Copernicus Data Space Ecosystem (but has <span class="co">[</span><span class="ot">openEO</span><span class="co">](https://openeo.org/)</span>: a fully open standard and open source software stack)</span>
<span id="cb19-217"><a href="#cb19-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-218"><a href="#cb19-218" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb19-219"><a href="#cb19-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clouds and object storage</span></span>
<span id="cb19-220"><a href="#cb19-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-221"><a href="#cb19-221" aria-hidden="true" tabindex="-1"></a>Object storage abstracts away hard drives and file systems!</span>
<span id="cb19-222"><a href="#cb19-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-223"><a href="#cb19-223" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>e.g. S3 bucket (AWS/OpenStack):</span>
<span id="cb19-224"><a href="#cb19-224" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>total size is _unlimited_</span>
<span id="cb19-225"><a href="#cb19-225" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>maximum object size 5 Tb (AWS S3)</span>
<span id="cb19-226"><a href="#cb19-226" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>idea: write once, read many times</span>
<span id="cb19-227"><a href="#cb19-227" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>large objects: write piece-wise</span>
<span id="cb19-228"><a href="#cb19-228" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>http range requests</span>
<span id="cb19-229"><a href="#cb19-229" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>price depends on size, access speed, amount of requests</span>
<span id="cb19-230"><a href="#cb19-230" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>tabular data: Parquet</span>
<span id="cb19-231"><a href="#cb19-231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>large data processing: collocate processing and storage</span>
<span id="cb19-232"><a href="#cb19-232" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>avoid network between locations / data centers</span>
<span id="cb19-233"><a href="#cb19-233" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>network inside a data center is fast / cheap</span>
<span id="cb19-234"><a href="#cb19-234" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-235"><a href="#cb19-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-236"><a href="#cb19-236" aria-hidden="true" tabindex="-1"></a><span class="fu">## Access mechanism</span></span>
<span id="cb19-237"><a href="#cb19-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-238"><a href="#cb19-238" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>API:</span>
<span id="cb19-239"><a href="#cb19-239" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>process: <span class="co">[</span><span class="ot">openEO cloud</span><span class="co">](https://openeo.cloud/)</span>, <span class="co">[</span><span class="ot">openEO on CDSE</span><span class="co">](https://openeo.dataspace.copernicus.eu/)</span>,</span>
<span id="cb19-240"><a href="#cb19-240" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>select, download, process: <span class="co">[</span><span class="ot">Climate Data Store</span><span class="co">](https://cds.climate.copernicus.eu/#!/home)</span></span>
<span id="cb19-241"><a href="#cb19-241" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>find "assets" (files): <span class="co">[</span><span class="ot">STAC</span><span class="co">](https://stacspec.org/en)</span>, <span class="co">[</span><span class="ot">stacindex</span><span class="co">](https://stacindex.org/)</span></span>
<span id="cb19-242"><a href="#cb19-242" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>partial reads of data cubes: variable, bounding box, strided (low resolution), time period</span>
<span id="cb19-243"><a href="#cb19-243" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>vector tiles: pmtiles, flatgeobuf</span>
<span id="cb19-244"><a href="#cb19-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-245"><a href="#cb19-245" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb19-246"><a href="#cb19-246" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cloud-optimized, cloud-native geoospatial</span></span>
<span id="cb19-247"><a href="#cb19-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-248"><a href="#cb19-248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cloud-optimized formats let you read *sections* of large, remote files using HTTP range requests</span>
<span id="cb19-249"><a href="#cb19-249" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>examples: Cloud-optimized GeoTIFF (COG), GeoZarr, GeoParquet</span>
<span id="cb19-250"><a href="#cb19-250" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These are described in the <span class="co">[</span><span class="ot">Cloud-Optimized Geospatial Formats Guide</span><span class="co">](https://guide.cloudnativegeo.org/)</span></span>
<span id="cb19-251"><a href="#cb19-251" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-252"><a href="#cb19-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-253"><a href="#cb19-253" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examples openEO</span></span>
<span id="cb19-254"><a href="#cb19-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-255"><a href="#cb19-255" aria-hidden="true" tabindex="-1"></a>Two video's from me taken during the 2023 OpenGeoHub Summerschool, on the topic "Cloud-based analysis of Earth Observation data using openEO Platform, R and Python" can be found here:</span>
<span id="cb19-256"><a href="#cb19-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-257"><a href="#cb19-257" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">part 1</span><span class="co">](https://www.youtube.com/watch?v=NurpU0V6JG8)</span></span>
<span id="cb19-258"><a href="#cb19-258" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">part 2</span><span class="co">](https://www.youtube.com/watch?v=mrY8VKOoz3c)</span></span>
<span id="cb19-259"><a href="#cb19-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-260"><a href="#cb19-260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example [`rstac`](https://cran.r-project.org/web/packages/rstac/index.html)</span></span>
<span id="cb19-261"><a href="#cb19-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-262"><a href="#cb19-262" aria-hidden="true" tabindex="-1"></a>Using <span class="co">[</span><span class="ot">Sentinel-2 COGs at AWS</span><span class="co">](https://registry.opendata.aws/sentinel-2-l2a-cogs/)</span>, and its <span class="co">[</span><span class="ot">stac</span><span class="co">](https://earth-search.aws.element84.com/v1)</span>:</span>
<span id="cb19-263"><a href="#cb19-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-266"><a href="#cb19-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-267"><a href="#cb19-267" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstac) <span class="co"># modified from the package docs:</span></span>
<span id="cb19-268"><a href="#cb19-268" aria-hidden="true" tabindex="-1"></a>s_obj <span class="ot">=</span> <span class="fu">stac</span>(<span class="st">"https://earth-search.aws.element84.com/v1"</span>)</span>
<span id="cb19-269"><a href="#cb19-269" aria-hidden="true" tabindex="-1"></a><span class="fu">collections</span>(s_obj) <span class="sc">|&gt;</span> <span class="fu">get_request</span>()</span>
<span id="cb19-270"><a href="#cb19-270" aria-hidden="true" tabindex="-1"></a>it_obj <span class="ot">&lt;-</span> s_obj <span class="sc">|&gt;</span></span>
<span id="cb19-271"><a href="#cb19-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stac_search</span>(<span class="at">collections =</span> <span class="st">"sentinel-2-l2a"</span>,</span>
<span id="cb19-272"><a href="#cb19-272" aria-hidden="true" tabindex="-1"></a>              <span class="at">bbox =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">47.02148</span>, <span class="sc">-</span><span class="fl">17.35063</span>, <span class="sc">-</span><span class="fl">42.53906</span>, <span class="sc">-</span><span class="fl">12.98314</span>),</span>
<span id="cb19-273"><a href="#cb19-273" aria-hidden="true" tabindex="-1"></a>              <span class="at">datetime =</span> <span class="st">"2022-02-12T00:00:00Z/2022-03-18T00:00:00Z"</span>,</span>
<span id="cb19-274"><a href="#cb19-274" aria-hidden="true" tabindex="-1"></a>              <span class="at">limit =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-275"><a href="#cb19-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_request</span>()</span>
<span id="cb19-276"><a href="#cb19-276" aria-hidden="true" tabindex="-1"></a>it_obj</span>
<span id="cb19-277"><a href="#cb19-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-278"><a href="#cb19-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-279"><a href="#cb19-279" aria-hidden="true" tabindex="-1"></a>then, download (here only one item):</span>
<span id="cb19-280"><a href="#cb19-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-281"><a href="#cb19-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb19-282"><a href="#cb19-282" aria-hidden="true" tabindex="-1"></a><span class="in">download_items &lt;- it_obj |&gt;</span></span>
<span id="cb19-283"><a href="#cb19-283" aria-hidden="true" tabindex="-1"></a><span class="in">  assets_download(assets_name = "thumbnail", items_max = 1, overwrite = TRUE)</span></span>
<span id="cb19-284"><a href="#cb19-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-285"><a href="#cb19-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-286"><a href="#cb19-286" aria-hidden="true" tabindex="-1"></a>and examine</span>
<span id="cb19-287"><a href="#cb19-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-288"><a href="#cb19-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=ev}</span></span>
<span id="cb19-289"><a href="#cb19-289" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb19-290"><a href="#cb19-290" aria-hidden="true" tabindex="-1"></a><span class="in">tif = "sentinel-s2-l2a-cogs/23/K/MA/2022/3/S2A_23KMA_20220317_0_L2A/B04.tif"</span></span>
<span id="cb19-291"><a href="#cb19-291" aria-hidden="true" tabindex="-1"></a><span class="in">gdal_utils("info", tif)</span></span>
<span id="cb19-292"><a href="#cb19-292" aria-hidden="true" tabindex="-1"></a><span class="in">library(stars)</span></span>
<span id="cb19-293"><a href="#cb19-293" aria-hidden="true" tabindex="-1"></a><span class="in">read_stars(tif) |&gt; plot()</span></span>
<span id="cb19-294"><a href="#cb19-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-295"><a href="#cb19-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-296"><a href="#cb19-296" aria-hidden="true" tabindex="-1"></a>::: {.callout-note title="Breakout session 2"}</span>
<span id="cb19-297"><a href="#cb19-297" aria-hidden="true" tabindex="-1"></a>Discuss:</span>
<span id="cb19-298"><a href="#cb19-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-299"><a href="#cb19-299" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Have you used any cloud platforms for processing geospatial data?</span>
<span id="cb19-300"><a href="#cb19-300" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is your position with respect to platform lock-in?</span>
<span id="cb19-301"><a href="#cb19-301" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb19-302"><a href="#cb19-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-303"><a href="#cb19-303" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further examples from r-spatial.org:</span></span>
<span id="cb19-304"><a href="#cb19-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-305"><a href="#cb19-305" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Cloud-based processing of satellite image collections in R using STAC, COGs, and on-demand data cubes</span><span class="co">](https://r-spatial.org/r/2021/04/23/cloud-based-cubes.html)</span></span>
<span id="cb19-306"><a href="#cb19-306" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Reading Zarr files with R package stars</span><span class="co">](https://r-spatial.org/r/2022/09/13/zarr.html)</span></span>
<span id="cb19-307"><a href="#cb19-307" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Processing large scale satellite imagery with openEO Platform and R</span><span class="co">](https://r-spatial.org/r/2022/11/24/openeo.html)</span></span>
<span id="cb19-308"><a href="#cb19-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-309"><a href="#cb19-309" aria-hidden="true" tabindex="-1"></a><span class="fu">## Examples `/vsixxx`</span></span>
<span id="cb19-310"><a href="#cb19-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-311"><a href="#cb19-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=ev}</span></span>
<span id="cb19-312"><a href="#cb19-312" aria-hidden="true" tabindex="-1"></a><span class="in">curl::curl_download(</span></span>
<span id="cb19-313"><a href="#cb19-313" aria-hidden="true" tabindex="-1"></a><span class="in">  "https://github.com/paleolimbot/geoarrow-data/releases/download/v0.0.1/nshn_water_line.gpkg",</span></span>
<span id="cb19-314"><a href="#cb19-314" aria-hidden="true" tabindex="-1"></a><span class="in">  "nshn_water_line.gpkg"</span></span>
<span id="cb19-315"><a href="#cb19-315" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb19-316"><a href="#cb19-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-317"><a href="#cb19-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-320"><a href="#cb19-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb19-321"><a href="#cb19-321" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-322"><a href="#cb19-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-323"><a href="#cb19-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-324"><a href="#cb19-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=ev}</span></span>
<span id="cb19-325"><a href="#cb19-325" aria-hidden="true" tabindex="-1"></a><span class="in">(w &lt;- read_sf("nshn_water_line.gpkg"))</span></span>
<span id="cb19-326"><a href="#cb19-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-327"><a href="#cb19-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-328"><a href="#cb19-328" aria-hidden="true" tabindex="-1"></a>From https://github.com/microsoft/USBuildingFootprints downloaded <span class="co">[</span><span class="ot">Maine.geojson.zip</span><span class="co">](https://minedbuildings.z5.web.core.windows.net/legacy/usbuildings-v2/Maine.geojson.zip)</span>, and read with</span>
<span id="cb19-329"><a href="#cb19-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-330"><a href="#cb19-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=ev}</span></span>
<span id="cb19-331"><a href="#cb19-331" aria-hidden="true" tabindex="-1"></a><span class="in">(m = read_sf("/vsizip/Maine.geojson.zip")) # /vsizip: indicates data source is a zipped file</span></span>
<span id="cb19-332"><a href="#cb19-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-333"><a href="#cb19-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-334"><a href="#cb19-334" aria-hidden="true" tabindex="-1"></a>or read directly from github into R:</span>
<span id="cb19-335"><a href="#cb19-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-336"><a href="#cb19-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb19-337"><a href="#cb19-337" aria-hidden="true" tabindex="-1"></a><span class="in">m = st_read("/vsizip/vsicurl/https://minedbuildings.z5.web.core.windows.net/legacy/usbuildings-v2/Maine.geojson.zip")</span></span>
<span id="cb19-338"><a href="#cb19-338" aria-hidden="true" tabindex="-1"></a><span class="in"># /vsicurl: indicates data source is a URL</span></span>
<span id="cb19-339"><a href="#cb19-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb19-340"><a href="#cb19-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-341"><a href="#cb19-341" aria-hidden="true" tabindex="-1"></a><span class="fu">## "Simple" analysis on large datasets</span></span>
<span id="cb19-342"><a href="#cb19-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-343"><a href="#cb19-343" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>process full archives, compute *in* the cloud</span>
<span id="cb19-344"><a href="#cb19-344" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>select subsets, download, process locally:</span>
<span id="cb19-345"><a href="#cb19-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>spatial subset</span>
<span id="cb19-346"><a href="#cb19-346" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>temporal subset</span>
<span id="cb19-347"><a href="#cb19-347" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>sampled at lower resolution (spatially, temporally)</span>
<span id="cb19-348"><a href="#cb19-348" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>aggregated (=processed?) to lower resolution</span>
<span id="cb19-349"><a href="#cb19-349" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>in some disciplines (Earth Observation?) there seems to be a belief that processing at the *full* resolution is the only thing that produces real science</span>
<span id="cb19-350"><a href="#cb19-350" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>there is surprisingly little literature on the loss of information when processing at lower resolution, e.g. when the goal is to create a curve of yearly deforestation over an area as large as Brazil</span>
<span id="cb19-351"><a href="#cb19-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-352"><a href="#cb19-352" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial statistics on large datasets</span></span>
<span id="cb19-353"><a href="#cb19-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-354"><a href="#cb19-354" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geostatistics</span></span>
<span id="cb19-355"><a href="#cb19-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-356"><a href="#cb19-356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">RandomForestsGLS</span><span class="co">](https://cran.r-project.org/web/packages/RandomForestsGLS/)</span></span>
<span id="cb19-357"><a href="#cb19-357" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">spNNGP</span><span class="co">](https://cran.r-project.org/web/packages/spNNGP/index.html)</span></span>
<span id="cb19-358"><a href="#cb19-358" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">FRK</span><span class="co">](https://cran.r-project.org/web/packages/FRK/index.html)</span></span>
<span id="cb19-359"><a href="#cb19-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-360"><a href="#cb19-360" aria-hidden="true" tabindex="-1"></a>A key paper comparing different approaches is Heaton, Matthew J., Abhirup Datta, Andrew O. Finley, Reinhard Furrer, Joseph Guinness, Rajarshi Guhaniyogi, Florian Gerber, et al. 2018. “A Case Study Competition Among Methods for Analyzing Large Spatial Data.” Journal of Agricultural, Biological and Environmental Statistics, December. <span class="co">[</span><span class="ot">DOI</span><span class="co">](https://doi.org/10.1007/s13253-018-00348-w)</span>.</span>
<span id="cb19-361"><a href="#cb19-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-362"><a href="#cb19-362" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises:</span></span>
<span id="cb19-363"><a href="#cb19-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-364"><a href="#cb19-364" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Discuss: Have you used datasets obtained from cloud storage? For which case(s)?</span>
<span id="cb19-365"><a href="#cb19-365" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Discuss: Have you used cloud processing? For which case(s)</span>
<span id="cb19-366"><a href="#cb19-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-367"><a href="#cb19-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## If time is left</span></span>
<span id="cb19-368"><a href="#cb19-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-369"><a href="#cb19-369" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Exercises chapter 9</span><span class="co">](https://r-spatial.org/book/09-Large.html#exercises)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sswr/edit/main/day5.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>